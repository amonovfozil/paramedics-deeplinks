<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Paramedics Dr</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: white;
            font-family: Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }

        .container {
            max-width: 400px;
            padding: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: #1a73e8;
            border-radius: 20px;
            margin: 0 auto 20px;
            color: white;
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        p {
            color: #666;
            margin-bottom: 30px;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid #f0f0f0;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .status {
            color: #666;
            font-size: 14px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="logo">P</div>
        <h1>Paramedics Dr</h1>
        <p>Opening application...</p>
        <div class="loader"></div>
        <div class="status" id="status">Initializing...</div>
    </div>

    <script>
        // Store URLs
        const APP_STORE_URL = 'https://apps.apple.com/uz/app/paramedics-dr/id6469779193';
        const PLAY_STORE_URL = 'https://play.google.com/store/apps/details?id=com.paramedics.paramedicsuz_doctor';

        // App deep link
        const APP_DEEP_LINK = 'paramedicsdr://deeplink';

        function getPlatform() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;

            // iOS detection
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return 'ios';
            }

            // Android detection
            if (/android/i.test(userAgent)) {
                return 'android';
            }

            // Mac detection
            const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
            if (isMac) {
                return 'mac';
            }

            return 'other';
        }

        function redirectToStore(platform) {
            let storeUrl = PLAY_STORE_URL;

            if (platform === 'ios') {
                storeUrl = APP_STORE_URL;
            } else if (platform === 'mac') {
                storeUrl = APP_STORE_URL; // macOS also uses App Store
            }

            // Store'ni yangi oynada ochish
            window.open(storeUrl, '_blank');

            // Joriy oynani yopishga urinish
            setTimeout(() => {
                try {
                    window.close();
                    // Agar close ishlamasa, sahifani redirect qilish
                    if (!window.closed) {
                        window.location.href = "about:blank";
                    }
                } catch (e) {
                    // Xatolik bo'lsa, faqat blank sahifaga o'tkazish
                    window.location.href = "about:blank";
                }
            }, 100);
        }

        function tryOpenApp() {
            const platform = getPlatform();
            document.getElementById('status').textContent = `Detected: ${platform.toUpperCase()}`;

            // 1. Avval app ni ochishga harakat qilish
            setTimeout(() => {
                document.getElementById('status').textContent = 'Trying to open app...';
                window.location.href = APP_DEEP_LINK;
            }, 500);

            // 2. Agar app ochilmagan bo'lsa, Store ga o'tkazish
            setTimeout(() => {
                document.getElementById('status').textContent = 'Redirecting to Store...';
                redirectToStore(platform);
            }, 1500);

            // 3. Agar 3 soniyadan keyin ham Store ga o'tmagan bo'lsa
            setTimeout(() => {
                if (document.visibilityState === 'visible') {
                    const platform = getPlatform();
                    redirectToStore(platform);
                }
            }, 3000);
        }

        // Visibility change handler - app ochilganini aniqlash uchun
        document.addEventListener('visibilitychange', function () {
            if (document.visibilityState === 'hidden') {
                // App ochildi, sahifani yopish
                setTimeout(() => {
                    try {
                        window.close();
                    } catch (e) {
                        // Ignore errors
                    }
                }, 1000);
            }
        });

        // Page blur handler - app ochilganini aniqlash uchun
        window.addEventListener('blur', function () {
            // App ochildi deb hisoblaymiz
            setTimeout(() => {
                try {
                    window.close();
                } catch (e) {
                    // Ignore errors
                }
            }, 1000);
        });

        // Sahifa yuklanganda boshlash
        window.addEventListener('load', function () {
            setTimeout(tryOpenApp, 300);
        });

        // Foydalanuvchi sahifani bossa ham ishga tushirish
        document.addEventListener('click', tryOpenApp);
    </script>
</body>

</html>