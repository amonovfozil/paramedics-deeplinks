<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Paramedics Dr</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: white;
            font-family: Arial;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }

        .container {
            max-width: 400px;
            padding: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: #1a73e8;
            border-radius: 20px;
            margin: 0 auto 20px;
            color: white;
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        p {
            color: #666;
            margin-bottom: 30px;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 4px solid #f0f0f0;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .status {
            color: #666;
            font-size: 14px;
            margin-top: 20px;
        }
    </style>
    <script>
        const APP_SCHEME = 'paramedicsdr://deeplink';
        const PLAY_STORE = 'https://play.google.com/store/apps/details?id=com.paramedics.paramedicsuz_doctor';
        const APP_STORE = 'https://apps.apple.com/uz/app/paramedics-dr/id6469779193';
        const MAC_APP_STORE = 'https://apps.apple.com/us/app/paramedics-dr/id6469779193';

        function detectPlatform() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;

            // iOS aniqlash
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return 'ios';
            }

            // Android aniqlash
            if (/android/i.test(userAgent)) {
                return 'android';
            }

            // macOS aniqlash
            if (/Macintosh|MacIntel|MacPPC|Mac68K/.test(userAgent)) {
                return 'macos';
            }

            return 'other';
        }

        function openStore(platform) {
            switch (platform) {
                case 'ios':
                    return APP_STORE;
                case 'macos':
                    return MAC_APP_STORE;
                case 'android':
                    return PLAY_STORE;
                default:
                    return PLAY_STORE;
            }
        }

        function checkAppInstalled(platform) {
            return new Promise((resolve) => {
                if (platform === 'ios' || platform === 'macos') {
                    // iOS/Mac uchun app mavjudligini tekshirish
                    const startTime = Date.now();
                    const timeout = 2000; // 2 soniya

                    // App scheme orqali ochishga urinish
                    window.location = APP_SCHEME;

                    setTimeout(() => {
                        // Agar app ochilmagan bo'lsa (2 soniya ichida sahifa hali bor)
                        if (Date.now() - startTime < timeout + 100) {
                            resolve(false);
                        }
                    }, timeout);

                    // App ochilsa, bu handler ishlaydi
                    window.onblur = function () {
                        resolve(true);
                        setTimeout(() => {
                            window.close();
                        }, 100);
                    };

                } else {
                    // Android va boshqa platformalar uchun
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = APP_SCHEME;

                    iframe.onload = function () {
                        setTimeout(() => {
                            resolve(false);
                            document.body.removeChild(iframe);
                        }, 2000);
                    };

                    iframe.onerror = function () {
                        resolve(false);
                        document.body.removeChild(iframe);
                    };

                    document.body.appendChild(iframe);

                    // Android app ochilsa
                    window.onblur = function () {
                        resolve(true);
                        setTimeout(() => {
                            window.close();
                        }, 100);
                    };
                }
            });
        }

        async function startRedirect() {
            const platform = detectPlatform();
            document.getElementById('status').textContent = `Platform: ${platform.toUpperCase()} detected`;

            try {
                // Avval app ochilishini tekshirish
                document.getElementById('status').textContent = 'Checking if app is installed...';

                const appInstalled = await Promise.race([
                    checkAppInstalled(platform),
                    new Promise(resolve => setTimeout(() => resolve(false), 2500))
                ]);

                if (appInstalled) {
                    // App mavjud va ochildi, web sahifani yopish
                    document.getElementById('status').textContent = 'App opened successfully';
                    setTimeout(() => {
                        if (window.history.length > 1) {
                            window.history.back();
                        } else {
                            window.close();
                        }
                    }, 500);
                    return;
                }

                // App mavjud emas, Store'ga yo'naltirish
                document.getElementById('status').textContent = 'Redirecting to Store...';
                const storeUrl = openStore(platform);

                // Store'ni yangi tabda ochish
                const newWindow = window.open(storeUrl, '_blank');

                // Agar yangi oyna ochilsa, joriy sahifani yopish
                if (newWindow) {
                    setTimeout(() => {
                        if (window.history.length > 1) {
                            window.history.back();
                        } else {
                            window.close();
                        }
                    }, 1000);
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('status').textContent = 'Error occurred. Redirecting to Store...';
                setTimeout(() => {
                    window.location.href = openStore(platform);
                }, 1000);
            }
        }

        window.onload = function () {
            setTimeout(startRedirect, 500);
        };

        // User click handler for manual retry
        document.addEventListener('click', function () {
            startRedirect();
        });
    </script>
</head>

<body>
    <div class="container">
        <div class="logo">P</div>
        <h1>Paramedics Dr</h1>
        <p>Opening application...</p>
        <div class="loader"></div>
        <div class="status" id="status">Initializing...</div>
    </div>
</body>

</html>

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Paramedics Dr</title>
    <style>
        body {margin:0;padding:0;background:white;font-family:Arial;display:flex;justify-content:center;align-items:center;height:100vh;text-align:center;}
        .container {max-width:400px;padding:20px;}
        .logo {width:80px;height:80px;background:#1a73e8;border-radius:20px;margin:0 auto 20px;color:white;font-size:32px;font-weight:bold;display:flex;align-items:center;justify-content:center;}
        h1 {color:#333;margin-bottom:10px;}
        p {color:#666;margin-bottom:30px;}
        .loader {width:50px;height:50px;border:4px solid #f0f0f0;border-top:4px solid #1a73e8;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto;}
        @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
        .status {color:#666;font-size:14px;margin-top:20px;}
    </style>
    <script>
        const PLAY_STORE = 'https://play.google.com/store/apps/details?id=com.paramedics.paramedicsuz_doctor';
        const APP_STORE = 'https://apps.apple.com/uz/app/paramedics-dr/id6469779193';
        
        function startRedirect() {
            document.getElementById('status').textContent = 'Opening app...';
            
            const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            // App ni ochishga urinish
            setTimeout(() => {
                window.location.href = 'paramedicsdr://deeplink';
                document.getElementById('status').textContent = 'Trying to open app...';
            }, 800);
            
            // Store ga o'tish
            setTimeout(() => {
                document.getElementById('status').textContent = 'Redirecting to store...';
                if (isIOS) {
                    window.location.href = APP_STORE;
                } else if (isAndroid) {
                    window.location.href = PLAY_STORE;
                } else {
                    window.location.href = PLAY_STORE;
                }
            }, 2000);
        }
        
        window.onload = function() {
            setTimeout(startRedirect, 500);
        };
    </script>
</head>
<body>
    <div class="container">
        <div class="logo">P</div>
        <h1>Paramedics Dr</h1>
        <p>Opening application...</p>
        <div class="loader"></div>
        <div class="status" id="status">Initializing...</div>
    </div>
</body>
</html> -->